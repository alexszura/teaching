---
title: "Effect of effect_size, variance, and sample_size on p-values"
output:
  html_document:
    df_print: paged
---

>Day03 – Assignment – Part 2

Like we discussed in class, apart from the null hypothesis (which need not always be equivalent to random chance), the p-value of a statistical test depends on:
1. Effect size,
2. Sample size, and
3. Variance within each group

To explore how these factors influence the p-value, I have written the code below to simulate data for two groups multiple times (just like the excercise we did in class), each time varying the `effect_size`, `std_deviation`, and `sample_size`, and calculating the p-value using a T-test.

Your tasks are the following:
1. Carefully examine and annotate the code by writing detailed comments at each step.
2. Examine the figure that is being produced and write a short paragraph about you observations on how these three quantities influence the p-value.


```{r}
library(tidyverse)
```

[ Add your notes here. ]

```{r}
# Add comments next to each code chunk to describe the data analysis steps

sample_data <- {}
es_sd_ss_pvalue <- {}

for(effect_size in seq(0.1, 1, 0.05)) {
  for(stddev in c(0.5, 1, 2)) {
    for(sample_size in c(5, 10, 20, 50, 100, 200, 500, 1000)) {
      group1 <- rnorm(sample_size, mean = 0, sd = stddev)
      group2 <- rnorm(sample_size, mean = effect_size, sd = stddev)

      sample_data <- rbind(sample_data,
                           cbind(rep(sample_size, sample_size),
                                 rep(effect_size, sample_size),
                                 rep(stddev, sample_size),
                                 group1,
                                 group2))

      ttest_out <- t.test(group1, group2)
      es_sd_ss_pvalue <- rbind(es_sd_ss_pvalue,
                            c(effect_size, stddev, sample_size, ttest_out$p.value))
    }
  }
}

colnames(es_sd_ss_pvalue) <- c("effect_size",
                               "std_deviation",
                               "sample_size",
                               "pvalue")
es_sd_ss_pvalue <- as_tibble(es_sd_ss_pvalue)
```

[ Add your notes here. ]

```{r}
# Add comments next to each code chunk to describe the data analysis steps

es_sd_ss_pvalue <- es_sd_ss_pvalue %>%
  mutate(pvalue_below_thresh = (pvalue < 0.05))
```

[ Add your notes here. ]

```{r}
# No need to add comments to this chunk that's just making the plot.
# However, it is useful to go through it to make sure you understand what is being plotted in the figure.

plot_es_sd_ss_pvalue <- es_sd_ss_pvalue %>%
  ggplot(aes(x = sample_size,
         y = effect_size,
         size = 2,
         #size = -log10(pvalue),
         color = pvalue_below_thresh,
         shape = pvalue_below_thresh)) +
  geom_point() +
  scale_shape_manual(values = c(4, 16)) +
  scale_color_manual(values = c("blue", "red")) +
  scale_x_log10() +
  facet_wrap(~std_deviation, nrow = 1) +
  theme_bw() +
  theme(legend.position = "none")

plot_es_sd_ss_pvalue

ggsave(filename = "effectsize_variance_samplesize_pvalue.pdf",
       plot_es_sd_ss_pvalue, height = 5, width = 12)
```


Question:
The figure contains 3 plots next to each other, one for each value `std_deviation`. In each plot, the `sample_size` values are along the x-axis and the `effect_size` values are along the y-axis. Each point is either a red dot or a blue cross depending on whether the p-value for the t-test between the two groups (for that combination of `effect_size`, `std_deviation` , and `sample_size`) is below 0.05 or not.

Examine the figure and write a short paragraph about you observations on how these three quantities influence the p-value.

[ Add your notes here. ]
